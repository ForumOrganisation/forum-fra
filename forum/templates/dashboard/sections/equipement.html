{% extends "dashboard/section.html" %} 
{% set title = 'Equipement' %} 
{% block main %} 
<!-- /.box-header -->
<div class="row">
    <div class="col-xs-12">
      <div class="box">
        <div class="box-header">
            <h3 class="box-title">Détails du stand</h3>
        </div>
        <!-- /.box-header -->
        <div class="box-body">
            <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label>durée</label>
                    <select class="form-control duration" style="width: 100%;">
                      <option>2</option>
                      <option>1</option>
                    </select>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-group">
                    <label>taille (m2)</label>
                    <select class="form-control size" style="width: 100%;">
                      <option>9</option>
                      <option>12</option>
                      <option>18</option>
                      <option>27</option>
                    </select>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-group">
                    <label>stand équipé</label>
                    <select class="form-control equiped" style="width: 100%;">
                      <option>oui</option>
                      <option>non</option>
                    </select>
                  </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label>bandeau</label>
                    <select class="form-control" style="width: 100%;">
                      <option>Avec</option>
                      <option>Sans</option>
                    </select>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-group">
                    <label>enseigne</label>
                    <div class="input-group">
                      <div class="input-group-addon">
                        <i class="fa fa-tag"></i>
                      </div>
                      <input type="text" class="form-control" id="banner" placeholder="{{ company.sections.equipement.general.banner }}">
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                	<br>
                  <button type="submit" class="btn btn-primary" id="confirm_stand">Confirmer</button>
                </div>
            </div>
          </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xs-12">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">Equipement</h3>
        </div>
      	<div class="box-body">
      		<div class="row">
      			<div class="col-md-12">
      				<div class="row">
      					<!-- /.col -->
      					<div class="col-md-12">
      						<!-- Widget: user widget style 1 -->
      						<div class="box box-widget widget-user-2">
      							<div class="box-footer no-padding">
                       <table class="table table-responsive">
                        <tbody>
                          <tr>
                            <td><span class="text-muted">Banque à hôtesse </span></td>
                            <td><span class="badge bg-grey">1</span></td>
                            <td><span class="badge bg-grey">inclus</span></td>
                            <td><i class="fa fa-remove" style="color:white"></i></td>
                          </tr>

                          <tr>
                            <td><span class="text-muted">Chaise </span></td>
                            <td><span class="badge bg-grey">1</span></td>
                            <td><span class="badge bg-grey">inclus</span></td>
                            <td><i class="fa fa-remove" style="color:white"></i></td>
                          </tr>

                          <tr>
                            <td><span class="text-muted">Portemanteau </span></td>
                            <td><span class="badge bg-grey">1</span></td>
                            <td><span class="badge bg-grey">inclus</span></td>
                            <td><i class="fa fa-remove" style="color:white"></i></td>
                          </tr>

                          <tr>
                            <td><span class="text-muted">Rail de spots </span></td>
                            <td><span class="badge bg-grey">1</span></td>
                            <td><span class="badge bg-grey">inclus</span></td>
                            <td><i class="fa fa-remove" style="color:white"></i></td>
                          </tr>

                          <tr>
                            <td><span class="text-muted">Tabouret haut </span></td>
                            <td><span class="badge bg-grey">1</span></td>
                            <td><span class="badge bg-grey">inclus</span></td>
                            <td><i class="fa fa-remove" style="color:white"></i></td>
                          </tr>                 

                          {% for k,v in company.sections.equipement.furniture.items() %}

                          <tr>
                            <td>{{ k }}</td>
                            <td><span class="badge bg-blue">{{ v }}</span></td>
                            <td><span class="badge bg-blue">30 €</span></td>
                            <td><i onclick="remove_furniture('{{ k }}', '{{ v }}')" class="fa fa-remove" style="color:red"></i></td>
                          </tr>

                          {% endfor %}

                        </tbody>
                      </table>
      							</div>
      						</div>
      					</div>
      				</div>
      			</div>
          </div>
        </div>
      </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
      <div class="box">
        <div class="box-header">
            <h3 class="box-title">Ajouter un équipement</h3>
            <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
            </div>
        </div>
        <!-- /.box-header -->
        <div class="box-body">
            <div class="row">
                <div class="col-md-3">

                  <div class="form-group">
                    <label>item</label>
                    <select class="form-control name" style="width: 100%;">
                      <option>Banque à hôtesse	- 89 €</option>
                      <option>Chaise - 35 €</option>
                      <option>Chauffeuse - 67 €</option>
                      <option>Mange-debout	- 89 €</option>
                      <option>Portemanteau - 35 €</option>
                      <option>Ecran LCD 26" - 67 €</option>
                      <option>Ecran LCD 32" - 60 €</option>
                      <option>Ecran LCD 42" - 29 €</option>
                      <option>Ecran LCD 52" - 78 €</option>
                    </select>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="form-group">
                    <label>quantité</label>
                    <select class="form-control quantity" style="width: 100%;">
                      <option>1</option>
                      <option>2</option>
                      <option>3</option>
                      <option>4</option>
                      <option>5</option>
                      <option>6</option>
                      <option>7</option>
                    </select>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="form-group">
                    <label>total</label>
                    <br><p>132 €</p>
                  </div>
                </div>

                <div class="col-md-3">
                  <br>
                  <button type="submit" class="btn btn-primary" id="confirm_add">Confirmer</button>
                </div>
              <!-- /.box -->
            </div>
          </div>
        </div>
      </div>  
    </div>
  </div>
</div>
{% endblock main %}

{% block scripts %}
<script type="text/javascript">
$('#confirm_stand').on('click', function(e) {
    e.preventDefault();
    var company = {{ company|tojson }};
    var general = company.sections.equipement.general;
    var stand = {
       duration: $(".duration").val(),
       equiped: $(".equiped").val(),
       banner: $("#banner").val(),
       size: $(".size").val()
    };
    if (stand.duration && stand.size && stand.equiped && stand.banner) {
        general.duration = stand.duration;
        general.equiped = stand.equiped;
        general.banner = stand.banner;
        general.size = stand.size;
        $.ajax({
            type: "POST",
            url: "{{ url_for('update_company') }}",
            data: {"company": JSON.stringify(company)},
            success: function() {
                Notify("Changements sauvegardés.");
            }
        });
    }
    else {
        Notify("Veuillez remplir tous les champs.", null, null, "error");
    }
    return false;
});

$('#confirm_add').on('click', function(e) {
    e.preventDefault();
    var company = {{ company|tojson }};
    var furnitures = company.sections.equipement.furniture;
    var furniture = {
       name: $(".name").val(),
       quantity: $(".quantity").val(),
    };
    console.log(furniture.name);
    console.log(furniture.quantity);
    if (furniture.name && furniture.quantity) {
      if (furnitures[furniture.name]){
        furnitures[furniture.name] = furnitures[furniture.name] + Number(furniture.quantity);
      } else {
        furnitures[furniture.name] = Number(furniture.quantity);
      }
        
        $.ajax({
            type: "POST",
            url: "{{ url_for('update_company') }}",
            data: {"company": JSON.stringify(company)},
            success: function() {
                Notify("Changements sauvegardés.");
            }
        });
    }
    else {
        Notify("Veuillez remplir tous les champs.", null, null, "error");
    }
    return false;
});

function remove_furniture(name, quantity) {
    var r = confirm("Confirmer la suppresion ?");
    if (r) {
        var company = {{ company|tojson }};
        if (quantity > 1){
          company.sections.equipement.furniture[name] = company.sections.equipement.furniture[name] - 1;
        } else {
          delete company.sections.equipement.furniture[name];
        }
        $.ajax({
            type: "POST",
            url: "{{ url_for('update_company') }}",
            data: {"company": JSON.stringify(company)},
            success: function() {
                Notify("Suppression confirmée..");
                setTimeout(function(){
                    location.reload();
                }, 1000); 
            }
        });
    }
}
</script>
{% endblock scripts %}

