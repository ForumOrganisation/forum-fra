{% extends "dashboard/section.html" %}
{% set title = 'Profil' %}
{% block main %}
  {% set profile = company.sections.profile %}
  <div class="row">
    <div class="col-xs-12">
      <div class="col-md-6">
        <div class="box">
          <div class="box-header">
            <h3 class="box-title">Responsable du stand</h3>
          </div>
          <br>
          <div class="box-body table-responsive no-padding">
            <form class="form-horizontal">
              <div class="form-group">
                <label for="inputName" class="col-sm-3 control-label">Responsable</label>
                <div class="col-sm-8">
                  <input type="text" class="form-control" id="name_stand" placeholder="ex: Marie MARTIN" value="{{ profile.stand.name|default('') }}">
                </div>
              </div>
              <div class="form-group">
                <label for="inputName" class="col-sm-3 control-label">Téléphone</label>

                <div class="col-sm-8">
                  <input type="text" class="form-control" id="phone_stand" placeholder="ex: 01 23 45 67 89" value="{{ profile.stand.phone|default('') }}" data-mask>
                </div>
              </div>
              <div class="form-group">
                <label for="inputName" class="col-sm-3 control-label">Fax</label>

                <div class="col-sm-8">
                  <input type="text" class="form-control" id="fax_stand" placeholder="ex: 01 23 45 67 89" value="{{ profile.stand.fax|default('') }}">
                </div>
              </div>
              <div class="form-group">
                <label for="inputEmail" class="col-sm-3 control-label">Email</label>

                <div class="col-sm-8">
                  <input class="form-control" id="mail_stand" placeholder="ex: marie.martin@entreprise.com" value="{{ profile.stand.mail|default('') }}"></input>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-offset-8 col-sm-7">
                  <button type="submit" class="btn btn-default" id="confirm_stand">Enregistrer</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="box">
          <div class="box-header">
            <h3 class="box-title">Informations de facturation</h3>
          </div>
          <br>

          <div class="box-body table-responsive no-padding">
            <form class="form-horizontal">
              <div class="form-group">
                <label for="inputName" class="col-sm-3 control-label">Nom</label>

                <div class="col-sm-8">
                  <input type="text" class="form-control" id="name_facturation" placeholder="ex: ABMI Groupe" value="{{ profile.facturation.name|default('') }}">
                </div>
              </div>
              <div class="form-group">
                <label for="inputName" class="col-sm-3 control-label">Adresse</label>

                <div class="col-sm-8">
                  <input type="text" class="form-control" id="address_facturation" placeholder="ex: 2 Rue de la République" value="{{ profile.facturation.address|default('') }}">

                </div>
              </div>
              <div class="form-group">
                <label for="inputName" class="col-sm-3 control-label">Code postal</label>

                <div class="col-sm-8">
                  <input type="text" class="form-control" id="code_postal" placeholder="ex: 69100" value="{{ profile.facturation.code_postal|default('') }}">
                </div>
              </div>

              <div class="form-group">
                <label for="inputName" class="col-sm-3 control-label">Ville</label>

                <div class="col-sm-8">
                  <input type="text" class="form-control" id="city" placeholder="ex: Villeurbanne" value="{{ profile.facturation.city|default('') }}">
                </div>
              </div>

              <div class="form-group">
                <label for="inputName" class="col-sm-3 control-label">Pays</label>

                <div class="col-sm-8">
                  <input type="text" class="form-control" id="country" placeholder="ex: France" value="{{ profile.facturation.country|default('') }}">
                </div>
              </div>

              <div class="form-group">
                <label for="inputName" class="col-sm-3 control-label">Téléphone</label>

                <div class="col-sm-8">
                  <input type="text" class="form-control" id="phone_facturation" placeholder="ex: 01 23 45 67 89" value="{{ profile.facturation.phone|default('') }}" data-mask>
                </div>
              </div>

              <div class="form-group">
                <label for="inputName" class="col-sm-3 control-label">Fax</label>

                <div class="col-sm-8">
                  <input type="text" class="form-control" id="fax_facturation" placeholder="ex: 01 23 45 67 89" value="{{ profile.facturation.fax|default('') }}">
                </div>
              </div>
              <div class="form-group">
                <label for="inputEmail" class="col-sm-3 control-label">Email</label>

                <div class="col-sm-8">
                  <input class="form-control" id="mail_facturation" placeholder="ex: marie.martin@entreprise.com" value="{{ profile.facturation.mail|default('') }}"></input>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-offset-8 col-sm-9">
                  <button type="submit" class="btn btn-default" id="confirm_facturation">Enregistrer</button>
                </div>
              </div>
            </form>
          </div>
          <!-- /.tab-pane -->
        </div>
        <!-- /.tab-content -->
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </div>
  </div>
</div>
</div>
{% endblock main %}
{% block scripts %}
<script type="text/javascript">
$('#confirm_stand').on('click', function (e) {
  e.preventDefault();
  var company = {{ company|tojson }};
  var stand_items = {
    name: $("#name_stand").val(),
    phone: $("#phone_stand").val(),
    fax: $("#fax_stand").val(),
    mail: $("#mail_stand").val()
  };
  if (stand_items.name && stand_items.phone && stand_items.fax && stand_items.mail) {
    company.sections.profile.stand = stand_items;
    $.ajax({
      type: "POST",
      url: "{{ url_for('update_company') }}",
      data: {
        "company": JSON.stringify(company)
      },
      success: function () {
        Notify("Changements sauvegardés.");
        setTimeout(function () {
          location.reload();
        }, 1000);
      }
    });
  } else {
    Notify("Veuillez remplir tous les champs.", null, null, "error");
  }
  return false;
});

$('#confirm_facturation').on('click', function (e) {
  e.preventDefault();
  var company = {{ company|tojson }};
  var facturation_items = {
    name: $("#name_facturation").val(),
    address: $("#address_facturation").val(),
    code_postal: $("#code_postal").val(),
    city: $("#city").val(),
    country: $("#country").val(),
    phone: $("#phone_facturation").val(),
    fax: $("#fax_facturation").val(),
    mail: $("#mail_facturation").val()
  };
  if (facturation_items.name && facturation_items.address && facturation_items.code_postal && facturation_items.city && facturation_items.country && facturation_items.phone && facturation_items.fax && facturation_items.mail) {
    company.sections.profile.facturation = facturation_items;
    $.ajax({
      type: "POST",
      url: "{{ url_for('update_company') }}",
      data: {
        "company": JSON.stringify(company)
      },
      success: function (msg) {
        console.log(msg);
        Notify("Changements sauvegardés.");
        setTimeout(function () {
          location.reload();
        }, 1000);
      }
    });
  } else {
    Notify("Veuillez remplir tous les champs.", null, null, "error");
  }
  return false;
});
</script>
{% endblock scripts %}
