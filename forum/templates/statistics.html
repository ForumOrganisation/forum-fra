{% extends 'admin/master.html' %}
{% block head %}
  <script src="{{ url_for('static', filename='build/flask_admin.min.js') }}"></script>
  <script>
    {% set stats = get_stats() %}
    {% set users = get_users() %}
    window.onload = function () {
      var ctxLog = document.getElementById("chartLog");
      var ctxUsers = document.getElementById("chartUsers");
      var dataLog = {
        labels: [
          "FRA", "CM", "Ecoles", "SI"
        ],
        datasets: [
          {
            label: "FRA",
            backgroundColor: 'rgba(255, 99, 132, 0.4)',
            data: {{ stats.get('fra').values() }}
          }, {
            label: "CM",
            backgroundColor: 'rgba(54, 162, 235, 0.4)',
            data: {{ stats.get('cm').values() }}
          }, {
            label: "Ecoles",
            backgroundColor: 'rgba(75, 192, 192, 0.4)',
            data: {{ stats.get('school').values() }}
          }, {
            label: "SI",
            backgroundColor: 'rgba(255, 206, 86, 0.4)',
            data: {{ stats.get('si').values() }}
          }
        ]
      };
      var dataUsers = {
        labels: {{ users.get('labels')|safe }},
        datasets: [
          {
            label: "confirm√©s",
            backgroundColor: 'rgba(255, 99, 132, 0.4)',
            data: {{ users.get('confirmed') }}
          }, {
            label: "inscrits",
            backgroundColor: 'rgba(54, 162, 235, 0.4)',
            data: {{ users.get('registered') }}
          }
        ]
      };
      var chartLog = new Chart(ctxLog, {
        type: 'bar',
        data: dataLog,
        fill: true,
        backgroundColor: 'rgba(255, 206, 86, 0.4)',
        options: {
          title: {
            display: true,
            text: 'Avancement Suivi Logistique'
          },
          barValueSpacing: 20,
          scales: {
            yAxes: [
              {
                ticks: {
                  min: 0,
                  max: 120
                }
              }
            ]
          }
        }
      });
      var chartUsers = new Chart(ctxUsers, {
        type: 'line',
        data: dataUsers,
        options: {
          title: {
            display: true,
            text: 'Nombre d\'inscrits'
          },
          scales: {
            yAxes: [
              {
                ticks: {
                  min: 0
                }
              }
            ]
          }
        }
      });
    }
  </script>
{% endblock %}
{% block body %}
  <canvas id="chartLog" style="width:100%; height:300px" class="model-list"></canvas>
  <canvas id="chartUsers" style="width:100%; height:300px" class="model-list"></canvas>
{% endblock %}
